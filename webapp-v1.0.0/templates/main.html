<!DOCTYPE html>

<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">

    <script type="text/javascript" src="../static/jquery-3.5.1/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="../static/jquery-3.5.1/popper.min.js"></script>
    <script type="text/javascript" src="../static/daterangepicker-master/moment.min.js"></script>
    <script type="text/javascript" src="../static/daterangepicker-master/daterangepicker.js"></script>
    <link rel="stylesheet" type="text/css" href="../static/daterangepicker-master/daterangepicker.css">
    <link rel="stylesheet" type="text/css" href="../static/bootstrap-4.3.1/css/bootstrap.min.css">
    <script type="text/javascript" src="../static/bootstrap-4.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/datatable-1.10.22/datatables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../static/datatable-1.10.22/datatables.min.css">
    <script type="text/javascript" src="../static/datatable-1.10.22/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="../static/datatable-1.10.22/buttons.html5.min.js"></script>
    <script type="text/javascript" src="../static/datatable-1.10.22/jszip.min.js"></script>
    <script type="text/javascript" src="../static/jspdf-2.1.1/jspdf.debug.js"></script>
    <script type="text/javascript" src="../static/jspdf-2.1.1/jspdf.umd.min.js"></script>
    <script type="text/javascript" src="../static/jspdf-2.1.1/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" type="text/css" href='https://fonts.googleapis.com/css?family=Open Sans'>
    <link rel="stylesheet" type="text/css" href="../static/fontawesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="../static/assets/css/base.css">
    <script type="text/javascript" src="../static/chartjs-2.9.3/js/Chart.bundle.js"></script>

    <title>Sistema de Consulta</title>
    <link rel="shortcut icon" href="../static/assets/images/api.png">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light">
        <a class="navbar-brand justify-content-center"><img class="d-inline-block align-top" height="35"
                src="../static/assets/images/puc.webp"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav1" aria-controls="nav1"
            aria-expanded="false" aria-label="Navegação">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="nav1">

            <ul class="navbar-nav">
                <li class="nav-item">

                </li>

                <li class="nav-item">

                <li class="nav-item">

                </li>
                <li class="nav-item">

                </li>

            </ul>
        </div>
    </nav>
    <div class="row justify-content-center text-black" style="margin-top: 10px;">
        <!-- card CEP -->
        <div class="card text-black o-hidden bg-light border-info h-100 px-2 mx-2 my-2" style="width: 50rem; ">
            <div class="card-body">
                <div class="row form-group justify-content-center">
                    <form id="formularioCep">
                        <div class="d-flex justify-content-center ">
                            <input type="text" id="inputCep" class="form-control" placeholder="CEP..."
                                oninput="validateInputsAndButtons()">
                            <div class="d-flex justify-content-center col-sm-2">
                                <button type="submit" class="btn btn-success" id="cepButton" disabled>
                                    <i id="cepPlay" class="fas fa-play"></i>
                                    <div id="cepLoader" class="spinner-border spinner-border-sm has-text-success d-none"
                                        role="status">
                                    </div>
                                </button>
                            </div>
                        </div>
                        <p class="d-none text-danger small" id="cepError">Oops...CEP não encontrado! ☹️</p>
                    </form>
                </div>
                <div class="form-group row">
                    <label for="inputBairro" class="col-sm-2 col-form-label">Bairro:</label>
                    <div class="col-sm-10">
                        <output type="text" class="form-control" id="inputBairro" placeholder="Bairro">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="inputRua" class="col-sm-2 col-form-label">Rua:</label>
                    <div class="col-sm-10">
                        <output type="text" class="form-control" id="inputRua" placeholder="Rua">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="inputLocalidade" class="col-sm-2 col-form-label">Localidade:</label>
                    <div class="col-sm-10">
                        <output type="text" class="form-control" id="inputLocalidade" placeholder="Localidade">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="inputUf" class="col-sm-2 col-form-label">UF:</label>
                    <div class="col-sm-10">
                        <output type="text" class="form-control" id="inputUf" placeholder="Uf">
                    </div>
                </div>
            </div>
        </div>
        <!--Card CNPJ-->
        <div class="card text-black o-hidden bg-light border-info h-100 px-2 mx-2 my-2" style="width: 50rem;">
            <div class="card-body">
                <div class="row form-group justify-content-center">
                    <form id="formularioCnpj">
                        <div class="d-flex justify-content-center ">
                            <input type="text" id="inputCnpj" class="form-control" placeholder="CNPJ..."
                                oninput="validateInputsAndButtons()">
                            <div class="d-flex justify-content-center col-sm-2">
                                <button type="submit" class="btn btn-success" id="cnpjButton" disabled>
                                    <i id="cnpjPlay" class="fas fa-play"></i>
                                    <div id="cnpjLoader"
                                        class="spinner-border spinner-border-sm has-text-success d-none" role="status">
                                    </div>
                                </button>
                            </div>
                        </div>
                        <p class="d-none text-danger small" id="cnpjError">Oops...CNPJ não encontrado! ☹️</p>
                    </form>
                </div>
                <div class="form-group row">
                    <label for="inputName" class="col-sm-2 col-form-label">Nome:</label>
                    <div class="col-sm-10">
                        <output type="text" class="form-control" id="inputName" placeholder="Nome">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="inputStatus" class="col-sm-2 col-form-label">Status:</label>
                    <div class="col-sm-10">
                        <output type="text" class="form-control" id="inputStatus" placeholder="Uf">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="inputSize" class="col-sm-2 col-form-label">Porte:</label>
                    <div class="col-sm-10">
                        <output type="text" class="form-control" id="inputSize" placeholder="Size">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="inputCity" class="col-sm-2 col-form-label">Localidade:</label>
                    <div class="col-sm-10">
                        <output type="text" class="form-control" id="inputCity" placeholder="Localidade">
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script>

    /***************************************** FUNCTIONS *****************************************/
    const inputCep = document.getElementById('inputCep');
    const cepButton = document.getElementById('cepButton');

    const inputCnpj = document.getElementById('inputCnpj');
    const cnpjButton = document.getElementById('cnpjButton');

    function validateInputsAndButtons() {
        if (inputCep?.value) inputCep.value = inputCep.value.replace(/[^0-9]+/g, '')
        if (inputCnpj?.value) inputCnpj.value = inputCnpj.value.replace(/[^0-9]+/g, '')

        if (inputCep?.value?.length === 8) cepButton.disabled = false;
        else cepButton.disabled = true;

        if (inputCnpj?.value?.length === 14) cnpjButton.disabled = false;
        else cnpjButton.disabled = true;
    }

    // CPF-->
    const cepLoader = document.getElementById('cepLoader')
    const cepPlay = document.getElementById('cepPlay')
    const cepError = document.getElementById('cepError')

    var formcep = document.getElementById('formularioCep');
    formcep.addEventListener('submit', function (e) {
        e.preventDefault();
        cep = document.getElementById('inputCep').value;
        jQuery.ajax({
            url: 'https://helper-api-dotnet-o6.fly.dev/Cep/' + cep.replace(/[^0-9]+/g, ''),
            type: 'GET',
            data: {},
            headers: {},
            beforeSend: function () {
                cepPlay.classList.add('d-none')
                cepLoader.classList.remove('d-none')
                cepError.classList.add('d-none')
            },
            error: function () {
                cepLoader.classList.add('d-none')
                cepPlay.classList.remove('d-none')
                cepError.classList.remove('d-none')
            },
            success: function (response) {
                cepLoader.classList.add('d-none')
                cepPlay.classList.remove('d-none')

                document.getElementById("inputBairro").innerHTML = response?.neighborhood;
                document.getElementById("inputRua").innerHTML = response?.street;
                document.getElementById("inputLocalidade").innerHTML = response?.city;
                document.getElementById("inputUf").innerHTML = response?.state;
            }
        });
    });

    // CNPJ-->
    const cnpjLoader = document.getElementById('cnpjLoader')
    const cnpjPlay = document.getElementById('cnpjPlay')
    const cnpjError = document.getElementById('cnpjError')

    var form = document.getElementById('formularioCnpj');
    form.addEventListener('submit', function (e) {
        e.preventDefault();
        cnpj = document.getElementById('inputCnpj').value;
        jQuery.ajax({
            url: 'https://helper-api-dotnet-o6.fly.dev/cnpj/completo/' + cnpj.replace(/[^0-9]+/g, ''),
            type: 'GET',
            data: {},
            headers: {},
            beforeSend: function () {
                cnpjPlay.classList.add('d-none')
                cnpjLoader.classList.remove('d-none')
                cnpjError.classList.add('d-none')
            },
            error: function () {
                cnpjLoader.classList.add('d-none')
                cnpjPlay.classList.remove('d-none')
                cnpjError.classList.remove('d-none')
            },
            success: function (response) {
                cnpjLoader.classList.add('d-none')
                cnpjPlay.classList.remove('d-none')

                document.getElementById("inputName").innerHTML = response?.company?.name;
                document.getElementById("inputSize").innerHTML = response?.company?.size?.acronym;
                document.getElementById("inputCity").innerHTML = response?.address?.city + ' / ' + response?.address?.street
                document.getElementById("inputStatus").innerHTML = response?.status?.text;
            }
        });
    });
</script>